/*! awdl-site 2015-04-02 */
YUI().use("node","anim","crossframe","router","event-resize",function(a){"use strict";function b(){var b=h.siblings(),c=a.DOM.viewportRegion(),d=c.height;if(b.each(function(a){d-=a.get("offsetHeight")}),g.hasClass("io-loading")){var e=a.one(".bubblingG"),f=e.get("offsetHeight");d+=f}return d}function c(){h.setStyles({height:b()})}function d(){h.siblings().each(function(a){a.addClass("hiddenSiblings")}),c()}function e(){h.siblings().each(function(a){a.removeClass("hiddenSiblings")}),c()}function f(a){var b=h.getAttribute("data-sourceUrl"),c=h.getAttribute("data-bookTheme"),d=a.params.identifier,e=a.params.page?a.params.page:1;h.setAttribute("data-identifier",d),"replace"===a.src&&(b=b+"/books/"+a.params.identifier+"/"+e,c&&(b=b+"?ctheme="+c),h.set("src",b))}var g=a.one("body"),h=a.one(".widget.book"),i=g.getAttribute("data-appRoot");g.addClass("io-loading");var j=new a.Router({root:i,routes:[{path:"/book/:identifier/:page",callbacks:f},{path:"/book/:identifier",callbacks:f}]});a.on("windowresize",c),a.on("button:button-fullscreen:on",d),a.on("button:button-fullscreen:off",e),a.on("openlayers:change",function(a){j.save("/book/"+h.getAttribute("data-identifier")+"/"+a.sequence)}),a.Global.on("crossframe:message",function(b,c){var d=JSON.parse(c.message);a.fire(d.fire,d.data)}),h.on("load",function(){var b=new a.Anim({node:this,to:{opacity:1},duration:.3});c(),b.run(),g.removeClass("io-loading")}),c(),j.replace(j.getPath())});