function series_pages ( callback , options ) {

  var _ = require('underscore') ;

  var request = require('request') ;

  var fs = require('fs') ;

  var conf = JSON.parse( fs.readFileSync ( __dirname + '/conf.json', 'utf8' ) ) ;
    
  var environment = options.parent_conf.environment ;
  
  var x = '?fl=*&fq=bundle:dlts_series&sm_series_collection_identifier:d72398c3-1cd7-4734-ab1c-3e3b29862cee&rows=1000&wt=json' ;
    
  if ( environment !== 'production' ) environment = '*' ;
    
    var template = __dirname + '/series_pages.mustache' ;

    request( conf[environment].request.series.src, function ( error, response, body ) {
        if ( !error && response.statusCode == 200 ) {
            var series = JSON.parse( body ) ;
            _.each ( series.response.docs , function ( doc ) {
            	if ( doc.bs_status ) {
            		
            	  var data;
            	  
            	  if ( conf.page ) data = conf.page ;

            	  data.data = JSON.parse( doc.zs_data ) ;
            	  
            	  if ( data.content ) {
                	
            		var sources = data.content.items.sources ;
            	    
                	var sources_length = data.content.items.sources.length ;
              	    
            	    data.sources = [];
            	    
              	    data.content.items.fq.push ( { 'filter' : 'is_ispartof_series' , 'value' : 1 } );
              	    
                    data.content.items.fq.push ( { 'filter' : 'ss_series_identifier' , 'value' : data.identifier } );

              	    for ( var i = 0; i < sources_length; i++ ) {
                	  data.sources.push( { 'src' : conf[environment].sources[sources[i]], 'source' : sources[i] });  
                    }
                    
            	  }
            	  
            	  data.label = doc.label            	
            	  
            	  data.identifier = doc.ss_identifier              	
            	  
            	  data.hash = doc.hash            	
            	  
            	  data.series_code = doc.sm_series_code   
            	  
                  var configuration = {
                    route: '/series/' + data.identifier + '/index.html',
                    template: template,
                    data: data
                  };

                  callback ( configuration ) ;

            	}
            });
        }
    });

}

exports.series_pages = series_pages;
